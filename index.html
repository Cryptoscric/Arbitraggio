<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>ARB SENTRY - Green Gap Fiodena Mode</title>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <style>
        :root { --glow: #00ff41; --bg: #050505; --card: #121212; --text: #e0e0e0; --red: #ff3333; --magenta: #ff00ff; }
        body { font-family: 'Segoe UI', Consolas, monospace; background: var(--bg); color: var(--text); margin: 0; padding: 10px; }
        
        .header { border-bottom: 2px solid var(--glow); padding-bottom: 8px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        .controls { background: #111; padding: 10px 20px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #222; display: flex; gap: 20px; align-items: center; }
        
        .control-group { display: flex; align-items: center; gap: 8px; }
        .controls label { font-size: 0.7rem; font-weight: 800; color: var(--glow); text-transform: uppercase; }
        .controls input { background: #2a2a2a; color: var(--glow); border: 1px solid #444; padding: 4px; border-radius: 4px; width: 60px; font-size: 0.8rem; text-align: center; outline: none; }
        
        .timer-container { flex-grow: 1; text-align: right; }
        #timer-text { font-size: 0.8rem; color: var(--glow); margin-bottom: 3px; display: block; }
        #countdown-bar { width: 100px; height: 4px; background: #222; border-radius: 2px; float: right; overflow: hidden; }
        #progress { height: 100%; background: var(--glow); width: 100%; transition: width 1s linear; }

        #main-grid { display: flex; flex-direction: column; gap: 15px; }
        .token-section { background: var(--card); border: 1px solid #222; border-radius: 10px; padding: 12px; }
        
        .token-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border-bottom: 1px solid #222; padding-bottom: 5px; }
        .token-info .name { color: var(--glow); font-size: 1rem; font-weight: 900; }
        .token-info .addr { color: var(--magenta); font-size: 0.75rem; font-weight: 600; cursor: pointer; }

        .dex-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
        .dex-card { background: #181818; border: 1px solid #333; padding: 8px; border-radius: 6px; text-align: center; }
        
        /* Modifiche richieste */
        .dex-name { font-size: 0.85rem; font-weight: 900; color: #888; text-transform: uppercase; margin-bottom: 4px; }
        .price { font-size: 0.9rem; font-weight: 800; color: #fff; display: block; }
        .price.high { color: var(--glow) !important; }
        .price.low { color: var(--red) !important; }

        .trade-btns { display: flex; gap: 3px; justify-content: center; margin-top: 5px; }
        .btn-trade { border: none; padding: 2px 5px; font-size: 0.6rem; font-weight: 900; cursor: pointer; border-radius: 2px; min-width: 22px; }
        .btn-buy { background: var(--glow); color: #000; }
        .btn-sell { background: var(--red); color: #fff; }

        .gap-value { font-size: 1.2rem; font-weight: 900; color: #444; }
        .profit-value { font-size: 1.2rem; font-weight: 900; color: #444; }
        .blink-green { color: var(--glow) !important; animation: blink 0.6s infinite; }
        #wallet-status { font-size: 0.7rem; cursor: pointer; color: var(--glow); border: 1px solid var(--glow); padding: 3px 6px; border-radius: 4px; }
        
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.2; } }
        .liq-info { font-size: 0.6rem; color: #555; display: block; margin-top: 3px; }
    </style>
</head>
<body>

<div class="header">
    <h2 style="color: var(--glow); margin:0; font-size: 1.1rem;">ARB SENTRY</h2>
    <span id="wallet-status" onclick="connectWallet()">CONNETTI WALLET</span>
</div>

<div class="controls">
    <div class="control-group"><label>GAP %</label><input type="number" id="threshold" value="1.0" step="0.1"></div>
    <div class="control-group"><label>SIM USDC</label><input type="number" id="usdc-amount" value="100"></div>
    <div class="control-group"><label>TRADE SOL</label><input type="number" id="trade-sol" value="0.1" step="0.01"></div>
    <div class="timer-container">
        <span id="timer-text">RE-RANK: 15s</span>
        <div id="countdown-bar"><div id="progress"></div></div>
    </div>
</div>

<div id="main-grid"></div>

<script>
    const TARGET_DEX_IDS = ["raydium", "orca", "meteora"];
    let mints = [];
    let timeLeft = 15;

    async function connectWallet() {
        if (window.solana) {
            await window.solana.connect();
            document.getElementById('wallet-status').innerText = "CONNECTED";
        }
    }

    async function loadMints() {
        const r = await fetch('mint.txt?v=' + Date.now());
        const t = await r.text();
        return t.split('\n').map(l => l.trim().split(/\s+/).pop()).filter(a => a && a.length > 30);
    }

    async function scan() {
        const threshold = parseFloat(document.getElementById('threshold').value);
        const simUsdc = parseFloat(document.getElementById('usdc-amount').value);
        const grid = document.getElementById('main-grid');
        
        for (const mint of mints) {
            try {
                const r = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${mint}`);
                const data = await r.json();
                const pairs = (data.pairs || []).filter(p => TARGET_DEX_IDS.includes(p.dexId.toLowerCase()));
                
                if (pairs.length > 0) {
                    const prices = pairs.map(p => parseFloat(p.priceUsd));
                    const maxP = Math.max(...prices), minP = Math.min(...prices);
                    const gap = pairs.length > 1 ? ((maxP - minP) / minP) * 100 : 0;
                    const profit = gap >= threshold ? ((simUsdc * 0.997 / minP) * maxP * 0.997) - simUsdc : 0;

                    let section = document.getElementById('sec-' + mint) || document.createElement('div');
                    if(!section.id) { section.id = 'sec-' + mint; section.className = 'token-section'; grid.appendChild(section); }

                    let dexHTML = '';
                    TARGET_DEX_IDS.forEach(id => {
                        const p = pairs.find(pair => pair.dexId.toLowerCase() === id);
                        if (p) {
                            const val = parseFloat(p.priceUsd);
                            const pCls = val === maxP && pairs.length > 1 ? "high" : (val === minP && pairs.length > 1 ? "low" : "");
                            dexHTML += `
                                <div class="dex-card">
                                    <div class="dex-name">${id}</div>
                                    <span class="price ${pCls}">$${val < 0.01 ? val.toFixed(7) : val.toFixed(4)}</span>
                                    <div class="trade-btns">
                                        <button class="btn-trade btn-buy">B</button>
                                        <button class="btn-trade btn-sell">S</button>
                                    </div>
                                    <span class="liq-info">LP: $${Math.round(p.liquidity?.usd || 0)}</span>
                                </div>`;
                        } else { dexHTML += `<div class="dex-card"><div class="dex-name">${id}</div><span>---</span></div>`; }
                    });

                    section.innerHTML = `
                        <div class="token-header"><div class="token-info"><span class="name">${pairs[0].baseToken.symbol}</span> <span class="addr">${mint.slice(0,6)}...</span></div></div>
                        <div class="dex-grid">${dexHTML}
                            <div class="dex-card"><div class="dex-name">GAP%</div><span class="gap-value ${gap>=threshold?'blink-green':''}">${gap.toFixed(2)}%</span></div>
                            <div class="dex-card"><div class="dex-name">PROFIT</div><span class="profit-value">$${profit.toFixed(2)}</span></div>
                        </div>`;
                }
            } catch (e) {}
        }
    }

    setInterval(() => {
        timeLeft--;
        document.getElementById('progress').style.width = (timeLeft / 15 * 100) + "%";
        if (timeLeft <= 0) { timeLeft = 15; scan(); }
    }, 1000);

    (async () => { mints = await loadMints(); scan(); })();
</script>
</body>
</html>

